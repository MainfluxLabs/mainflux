openapi: 3.0.1
info:
  title: Mainflux rules service
  description: HTTP API for managing platform rules.
  version: 1.0.0

paths:
  /groups/{groupId}/rules:
    post:
      summary: Adds new rules
      description: Adds new rules to the list of rules for certain group identified by the provided ID
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/GroupId"
      requestBody:
        $ref: "#/components/requestBodies/CreateRulesReq"
      responses:
        '201':
          $ref: "#/components/responses/CreateRulesRes"
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
    get:
      summary: Retrieves rules by group
      description: Retrieves list of rules related to a certain group identified by the provided ID.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/GroupId"
      responses:
        '200':
          $ref: "#/components/responses/ListRulesRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
  /things/{thingId}/rules:
    get:
      summary: Retrieves rules assigned to a thing
      description: Retrieves list of rules assigned to a specific thing identified by the provided ID.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/ThingId"
      responses:
        '200':
          $ref: "#/components/responses/ListRulesRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
    post:
      summary: Assigns rules to a thing
      description: Assigns rules to a specific thing identified by the provided ID.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/ThingId"
      requestBody:
        $ref: "#/components/requestBodies/ThingRulesReq"
      responses:
        '200':
          description: Rules assigned successfully.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Thing or one of the rules does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
    patch:
      summary: Unassigns rules from a thing
      description: Unassigns rules from a specific thing identified by the provided ID.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/ThingId"
      requestBody:
        $ref: "#/components/requestBodies/ThingRulesReq"
      responses:
        '200':
          description: Rules unassigned successfully.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Thing or one of the rules does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
  /rules/{ruleId}/things:
    get:
      summary: Retrieves thing IDs assigned to a rule
      description: Retrieves list of thing IDs that have the specified rule assigned.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/RuleId"
      responses:
        '200':
          $ref: "#/components/responses/ListThingIDsRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Rule does not exist.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
  /rules/{ruleId}:
    get:
      summary: Retrieves rule info
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/RuleId"
      responses:
        '200':
          $ref: "#/components/responses/RuleRes"
        '401':
          description: Missing or invalid access token provided.
        '404':
          description: Rule does not exist.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
    put:
      summary: Updates rule info
      description: Update is performed by replacing the current resource data with values provided in a request payload.
      tags:
        - rules
      parameters:
        - $ref: "#/components/parameters/RuleId"
      requestBody:
        $ref: "#/components/requestBodies/UpdateRuleReq"
      responses:
        '200':
          description: Rule updated.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '404':
          description: Rule does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
  /rules:
    patch:
      summary: Removes rules
      description: Removes rules with provided identifiers.
      tags:
        - rules
      requestBody:
        $ref: "#/components/requestBodies/RemoveRulesReq"
      responses:
        '204':
          description: Rules removed.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '500':
          $ref: "#/components/responses/ServiceError"
  /groups/{groupId}/scripts:
    post:
      summary: Create Lua scripts.
      description: Add new Lua scripts to a specific Group
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/GroupId"
      requestBody:
        $ref: "#/components/requestBodies/CreateScriptsReq"
      responses:
        '201':
          $ref: "#/components/responses/CreateScriptsRes"
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
    get:
      summary: Retrieve Scripts by Group.
      description: Retrieves a list of Lua scripts related to a certain group identified by the provided ID.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/GroupId"
      responses:
        '200':
          $ref: "#/components/responses/ListScriptsRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
  /things/{thingId}/scripts:
    get:
      summary: Retrieve Scripts assigned to a Thing.
      description: Retrieves a list of Lua scripts assigned to a specific Thing identified by the provided ID.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ThingId"
      responses:
        '200':
          $ref: "#/components/responses/ListScriptsRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
    post:
      summary: Assign Scripts to a Thing.
      description: Assigns one or more Lua scripts to a specific thing identified by the provided ID.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ThingId"
      requestBody:
        $ref: "#/components/requestBodies/ThingScriptsReq"
      responses:
        '200':
          description: Scripts assigned successfully.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Thing or one of the scripts does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
    patch:
      summary: Unassign Scripts from Thing.
      description: Unassigns Lua scripts from a specific thing identified by the provided ID.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ThingId"
      requestBody:
        $ref: "#/components/requestBodies/ThingScriptsReq"
      responses:
        '200':
          description: Scripts unassigned successfully.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Thing or one of the scripts does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
  /scripts/{scriptId}/things:
    get:
      summary: Retrieve list of IDs of Things assigned a specific Script identified by the provided ID.
      description: Retrieve list of IDs of Things assigned a specific Script identified by the provided ID.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ScriptId"
      responses:
        '200':
          $ref: "#/components/responses/ListThingIDsRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '404':
          description: Script does not exist.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
  /scripts/{scriptId}:
    get:
      summary: Retrieve a specific Script.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ScriptId"
      responses:
        '200':
          $ref: "#/components/responses/ScriptRes"
        '401':
          description: Missing or invalid access token provided.
        '404':
          description: Script does not exist.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
    put:
      summary: Update a specific Script.
      description: Update script data.
      tags:
        - scripts
      parameters:
        - $ref: "#/components/parameters/ScriptId"
      requestBody:
        $ref: "#/components/requestBodies/UpdateScriptReq"
      responses:
        '200':
          description: Script updated.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '404':
          description: Script does not exist.
        '415':
          description: Missing or invalid content type.
        '500':
          $ref: "#/components/responses/ServiceError"
  /scripts:
    patch:
      summary: Remove scripts.
      description: Remove one or more Lua scripts with provided IDs.
      tags:
        - scripts
      requestBody:
        $ref: "#/components/requestBodies/RemoveScriptsReq"
      responses:
        '204':
          description: Scripts removed.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '500':
          $ref: "#/components/responses/ServiceError"
  /things/{thingId}/runs:
    get:
      summary: Retrieve Script runs for a Thing.
      description: Retrieve a list of script run history for a specific Thing identified by the provided ID.
      tags:
        - script-runs
      parameters:
        - $ref: "#/components/parameters/ThingId"
      responses:
        '200':
          $ref: "#/components/responses/ListScriptRunsRes"
        '400':
          description: Failed due to malformed query parameters.
        '401':
          description: Missing or invalid access token provided.
        '403':
          description: Failed to perform authorization over the entity.
        '422':
          description: Database can't process request.
        '500':
          $ref: "#/components/responses/ServiceError"
  /runs:
    patch:
      summary: Removes script runs
      description: Remove script run records with provided IDs..
      tags:
        - script-runs
      requestBody:
        $ref: "#/components/requestBodies/RemoveScriptRunsReq"
      responses:
        '204':
          description: Script runs removed.
        '400':
          description: Failed due to malformed JSON.
        '401':
          description: Missing or invalid access token provided.
        '500':
          $ref: "#/components/responses/ServiceError"

components:
  schemas:
    Condition:
      type: object
      properties:
        field:
          type: string
          example: "temperature"
        comparator:
          type: string
          example: ">="
        threshold:
          type: number
          example: 45
      required: [field, comparator, threshold]
    Action:
      type: object
      properties:
        id:
          type: string
          description: Required for smtp and smpp actions.
          example: "513e2557-e09b-42d3-s456-425614175403"
        type:
          type: string
          enum: [ smtp, smpp, alarm ]
          example: "smtp"
      required:
        - type
    RuleReqSchema:
      type: object
      properties:
        name:
          type: string
          example: "Temperature and Humidity Alert"
        description:
          type: string
          example: "Triggers when temperature exceeds 45°C and humidity drops below 20%"
        conditions:
          type: array
          items:
            $ref: "#/components/schemas/Condition"
        operator:
          type: string
          enum: [AND, OR]
          example: "AND"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/Action"
      required: [name, conditions, actions]
    RuleResSchema:
      type: object
      properties:
        id:
          type: string
          example: "789e4567-e89b-12d3-a456-426614174abc"
        group_id:
          type: string
          example: "321e4567-e89b-12d3-a456-426614174def"
        name:
          type: string
          example: "Temperature and Humidity Alert"
        description:
          type: string
          example: "Triggers when temperature exceeds 45°C and humidity drops below 20%"
        conditions:
          type: array
          items:
            $ref: "#/components/schemas/Condition"
        operator:
          type: string
          example: "AND"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/Action"
      required: [ id, group_id, name, conditions, actions ]
    ThingIDsRes:
      type: object
      properties:
        thing_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["123e4567-e89b-12d3-a456-426614174000", "123e4567-e89b-12d3-a456-426614174001"]
    ScriptReqSchema:
      type: object
      properties:
        name:
          type: string
          example: "Temperature Data Transformation"
        description:
          type: string
          example: "Converts temperature from Celsius to Fahrenheit and adds metadata"
        script:
          type: string
          example: |
              temp = mfx.message.payload["temperature"]
              if temp < 3.5 then
                  mfx.create_alarm()
                  mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
              end
      required: [name, script]
    ScriptResSchema:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "456e4567-e89b-12d3-a456-426614174abc"
        group_id:
          type: string
          format: uuid
          example: "321e4567-e89b-12d3-a456-426614174def"
        name:
          type: string
          example: "Temperature Data Transformation"
        description:
          type: string
          example: "Converts temperature from Celsius to Fahrenheit and adds metadata"
        script:
          type: string
          example: |
            temp = mfx.message.payload["temperature"]
            if temp < 3.5 then
                mfx.create_alarm()
                mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
            end
      required: [id, group_id, name, script]
    ScriptRunResSchema:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "789e4567-e89b-12d3-a456-426614174xyz"
        script_id:
          type: string
          format: uuid
          example: "456e4567-e89b-12d3-a456-426614174abc"
        thing_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        logs:
          type: array
          items:
            type: string
          example: ["Processing message", "Temperature converted successfully"]
        started_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        finished_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:01Z"
        status:
          type: string
          enum: [success, fail]
          example: "success"
        error:
          type: string
          example: ""
      required: [id, script_id, thing_id, logs, started_at, finished_at, status]

  parameters:
    RuleId:
      name: ruleId
      description: Unique rule identifier.
      in: path
      schema:
        type: string
        format: uuid
      example: "789e4567-e89b-12d3-a456-426614174abc"
      required: true
    GroupId:
      name: groupId
      description: Unique group identifier.
      in: path
      schema:
        type: string
        format: uuid
      example: "321e4567-e89b-12d3-a456-426614174def"
      required: true
    ThingId:
      name: thingId
      description: Unique thing identifier.
      in: path
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"
      required: true
    ScriptId:
      name: scriptId
      description: Unique script identifier.
      in: path
      schema:
        type: string
        format: uuid
      example: "456e4567-e89b-12d3-a456-426614174abc"
      required: true

  requestBodies:
    CreateRulesReq:
      description: JSON-formatted document describing the new rules.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              rules:
                type: array
                items:
                  $ref: "#/components/schemas/RuleReqSchema"
            required:
              - rules
          example:
            rules:
              - name: "Temperature and Humidity Alert"
                description: "Triggers when temperature exceeds 45°C and humidity drops below 20%"
                conditions:
                  - field: "temperature"
                    comparator: ">"
                    threshold: 45
                  - field: "humidity"
                    comparator: "<"
                    threshold: 20
                operator: "AND"
                actions:
                  - type: "smtp"
                    id: "513e2557-e09b-42d3-s456-425614175403"
                  - type: "alarm"
    UpdateRuleReq:
      description: JSON-formatted document describing the updated rule.
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RuleReqSchema"
          example:
            name: "Temperature Alert"
            description: "Triggers when temperature exceeds 50°C"
            conditions:
              - field: "temperature"
                comparator: ">"
                threshold: 50
            actions:
              - type: "alarm"
    RemoveRulesReq:
      description: JSON-formatted document describing the identifiers of rules for deleting.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              rule_ids:
                type: array
                items:
                  type: string
                  format: uuid
            required:
              - rule_ids
          example:
            rule_ids:
              - "789e4567-e89b-12d3-a456-426614174abc"
              - "654e4567-e89b-12d3-a456-426614174999"
    ThingRulesReq:
      description: JSON-formatted document describing the rule identifiers to assign/unassign.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              rule_ids:
                type: array
                items:
                  type: string
                  format: uuid
            required:
              - rule_ids
          example:
            rule_ids:
              - "789e4567-e89b-12d3-a456-426614174abc"
              - "654e4567-e89b-12d3-a456-426614174999"
    CreateScriptsReq:
      description: JSON-formatted document describing the new Lua scripts.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              scripts:
                type: array
                items:
                  $ref: "#/components/schemas/ScriptReqSchema"
            required:
              - scripts
          example:
            scripts:
              - name: "Low temperature notifier"
                description: "Create alarm and send SMTP notification on low temperature."
                script: |
                  temp = mfx.message.payload["temperature"]
                  if temp < 3.5 then
                      mfx.create_alarm()
                      mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
                  end
    UpdateScriptReq:
      description: JSON-formatted document describing the updated Lua script.
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ScriptReqSchema"
          example:
            name: "Enhanced Temperature Transformation"
            description: "Converts temperature and adds validation"
            script: |
                temp = mfx.message.payload["temperature"]
                if temp < 3.5 then
                    mfx.create_alarm()
                    mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
                end
    RemoveScriptsReq:
      description: JSON-formatted document describing the IDs of scripts for deleting.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              script_ids:
                type: array
                items:
                  type: string
                  format: uuid
            required:
              - script_ids
          example:
            script_ids:
              - "456e4567-e89b-12d3-a456-426614174abc"
              - "789e4567-e89b-12d3-a456-426614174def"
    ThingScriptsReq:
      description: JSON-formatted document describing the script IDs to assign/unassign.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              script_ids:
                type: array
                items:
                  type: string
                  format: uuid
            required:
              - script_ids
          example:
            script_ids:
              - "456e4567-e89b-12d3-a456-426614174abc"
              - "789e4567-e89b-12d3-a456-426614174def"
    RemoveScriptRunsReq:
      description: JSON-formatted document describing the IDs of script runs to delete.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              script_run_ids:
                type: array
                items:
                  type: string
                  format: uuid
            required:
              - script_run_ids
          example:
            script_run_ids:
              - "789e4567-e89b-12d3-a456-426614174xyz"
              - "123e4567-e89b-12d3-a456-426614174qrs"

  responses:
    CreateRulesRes:
      description: Rules created.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: "#/components/schemas/RuleResSchema"
          example:
            - id: "84d1be5e-3511-4d15-aafa-b1bb4c20bca4"
              group_id: "fc1e40aa-c5af-4a1d-b1e4-37f2e4bb50d1"
              name: "Temperature and Humidity Alert"
              description: "Triggers when temperature exceeds 45°C and humidity drops below 20%"
              conditions:
                - field: "temperature"
                  comparator: ">"
                  threshold: 45
                - field: "humidity"
                  comparator: "<"
                  threshold: 20
              operator: "AND"
              actions:
                - type: "smtp"
                  id: "513e2557-e09b-42d3-s456-425614175403"
                - type: "alarm"
    RuleRes:
      description: Data retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RuleResSchema"
          example:
            id: "789e4567-e89b-12d3-a456-426614174abc"
            group_id: "321e4567-e89b-12d3-a456-426614174def"
            name: "Temperature Alert"
            description: "Triggers when temperature exceeds 45°C"
            conditions:
              - field: "temperature"
                comparator: ">"
                threshold: 45
            actions:
              - type: "smtp"
                id: "513e2557-e09b-42d3-s456-425614175403"
    ListRulesRes:
      description: Rules retrieved.
      content:
        application/json:
          schema:
            type: object
            properties:
              rules:
                type: array
                items:
                  $ref: "#/components/schemas/RuleResSchema"
            required:
              - rules
          example:
            rules:
              - id: "789e4567-e89b-12d3-a456-426614174abc"
                group_id: "321e4567-e89b-12d3-a456-426614174def"
                name: "Temperature Alert"
                description: "Triggers when temperature exceeds 45°C"
                conditions:
                  - field: "temperature"
                    comparator: ">"
                    threshold: 45
                actions:
                  - type: "smtp"
                    id: "513e2557-e09b-42d3-s456-425614175403"
    ListThingIDsRes:
      description: Thing IDs retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ThingIDsRes"
          example:
            thing_ids:
              - "123e4567-e89b-12d3-a456-426614174000"
              - "123e4567-e89b-12d3-a456-426614174001"
    CreateScriptsRes:
      description: Scripts created.
      content:
        application/json:
          schema:
            type: object
            properties:
              scripts:
                type: array
                items:
                  $ref: "#/components/schemas/ScriptResSchema"
            required:
              - scripts
          example:
            scripts:
              - id: "456e4567-e89b-12d3-a456-426614174abc"
                group_id: "321e4567-e89b-12d3-a456-426614174def"
                name: "Temperature Data Transformation"
                description: "Converts temperature from Celsius to Fahrenheit"
                script: |
                  temp = mfx.message.payload["temperature"]
                  if temp < 3.5 then
                      mfx.create_alarm()
                      mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
                  end
    ScriptRes:
      description: Script data retrieved.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ScriptResSchema"
          example:
            id: "456e4567-e89b-12d3-a456-426614174abc"
            group_id: "321e4567-e89b-12d3-a456-426614174def"
            name: "Low temperature notifier"
            description: "Create alarm and send SMTP notifier on low temperature value"
            script: |
                temp = mfx.message.payload["temperature"]
                if temp < 3.5 then
                    mfx.create_alarm()
                    mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
                end
    ListScriptsRes:
      description: Scripts retrieved.
      content:
        application/json:
          schema:
            type: object
            properties:
              scripts:
                type: array
                items:
                  $ref: "#/components/schemas/ScriptResSchema"
              total:
                type: integer
                example: 2
              offset:
                type: integer
                example: 0
              limit:
                type: integer
                example: 10
            required:
              - scripts
          example:
            total: 2
            offset: 0
            limit: 10
            scripts:
              - id: "456e4567-e89b-12d3-a456-426614174abc"
                group_id: "321e4567-e89b-12d3-a456-426614174def"
                name: "Low temperature notifier"
                description: "Create alarm and send SMTP notifier on low temperature value"
                script: |
                  temp = mfx.message.payload["temperature"]
                  if temp < 3.5 then
                      mfx.create_alarm()
                      mfx.smtp_notify("654e4567-e89b-12d3-a456-426614174999")
                  end
    ListScriptRunsRes:
      description: Script runs retrieved.
      content:
        application/json:
          schema:
            type: object
            properties:
              runs:
                type: array
                items:
                  $ref: "#/components/schemas/ScriptRunResSchema"
              total:
                type: integer
                example: 5
              offset:
                type: integer
                example: 0
              limit:
                type: integer
                example: 10
            required:
              - runs
          example:
            total: 5
            offset: 0
            limit: 10
            runs:
              - id: "789e4567-e89b-12d3-a456-426614174xyz"
                script_id: "456e4567-e89b-12d3-a456-426614174abc"
                thing_id: "123e4567-e89b-12d3-a456-426614174000"
                logs:
                  - "Processing message"
                  - "temp = 10.7"
                started_at: "2024-01-15T10:30:00Z"
                finished_at: "2024-01-15T10:30:01Z"
                status: "success"
                error: ""
    ServiceError:
      description: Unexpected server-side error occurred.
      content:
        application/json:
          schema:
            type: string
            format: byte

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        * Users access: "Authorization: Bearer <user_token>"

security:
  - bearerAuth: [ ]
